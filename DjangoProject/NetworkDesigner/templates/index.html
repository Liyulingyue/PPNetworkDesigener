<!DOCTYPE html> <!-- 声明文档类型为HTML5 -->
<html lang="en"> <!-- 定义HTML文档，lang属性指定文档语言为英语 -->

<head>
    <meta charset="UTF-8">  <!-- 设置文档的字符编码为UTF-8，以确保支持国际化字符 -->
    <title>PaddlePaddle Network Designer</title> <!-- 设置网页标题，这里标题被设置为"Title"，但通常这里会放置更具描述性的标题 -->
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/index.css' %}">
</head>

<body> <!-- 网页的主体部分开始 -->

<!-- 标题栏 -->
<div style="background-color: #ffffff; height:25px; padding: 15px 15px;"> <!-- 创建一个div元素作为导航栏，设置背景色为白色，高度为25px，内边距为上下15px，左右250px -->
    <a href="./" style="text-decoration: none; color: #000; font-size:18px"> <!-- 创建一个超链接（a标签），href属性指定链接到当前页面（"./"），并设置样式 -->
        <strong>PaddlePaddle Network Designer</strong>
    </a>
</div>

<!-- 主体框 -->
<div class="container">
    <!-- 导航栏 -->
    <div class="navbar"><p>加载中...</p></div>
    <!-- 这里是画布区域，但实际上我们将它用作一个容器来动态添加内容 -->
    <div class="canvas" id="elements-canvas"></div>


    <!-- 信息栏/内容栏 -->
    <div class="content" id="content-block">
        <div class="element-information" id="content-item1">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h2 style="margin: 0;">节点</h2> <!-- 标题部分，表示这是块信息 -->
                <button id="content-item1-fresh" style="margin-left: 10px;">刷新</button>
            </div>
            <hr> <!-- 分割线 -->
            <div>
                <h3>选择节点</h3>
                <select id="networkNodeSelector"></select> <!-- 创建一个下拉列表，用于选择网络节点 -->
            </div>
            <div>
                <h3>属性</h3>
                <div class="element-information-features"></div> <!-- 创建一个div元素，用于显示节点属性 -->
            </div>
            <hr> <!-- 分割线 -->
            <div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h3 style="margin: 0;">参数</h3> <!-- 标题部分，表示这是块信息 -->
                    <button id="content-item1-addparams" style="margin-left: 10px;">新增</button>
                </div>
                <div class="element-information-params"></div> <!-- 创建一个div元素，用于显示节点属性 -->
            </div>
            <hr> <!-- 分割线 -->
            <div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h3 style="margin: 0;">输入</h3>
                    <button id="content-item1-addinputs" style="margin-left: 10px;">新增</button>
                </div>
                <div class="element-information-inputs"></div> <!-- 创建一个div元素，用于显示节点属性 -->
            </div>
            <hr> <!-- 分割线 -->
            <div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h3 style="margin: 0;">返回值</h3>
                    <button id="content-item1-addoutputs" style="margin-left: 10px;">新增</button>
                </div>
                <div class="element-information-outputs"></div> <!-- 创建一个div元素，用于显示节点属性 -->
            </div>
            <hr> <!-- 分割线 -->


        </div>
        <div class="content-item" id="content-item2" style="display:none;">
            <h2>连接</h2> <!-- 标题部分，表示这是块信息 -->
        </div>
        <div class="content-item" id="content-item3" style="display:none;">这是条目 3 的内容</div>
    </div>

    <!-- 侧边栏 -->
    <div class="sidebar">
        <button class="sidebar-item" data-content="content-item1">节点</button>
        <button class="sidebar-item" data-content="content-item2">连接</button>
        <button class="sidebar-item" data-content="content-item3">条目 3</button>
    </div>


</div>


<!-- 将<script>标签放在<body>标签的底部，以确保DOM元素已加载 -->
<!-- 加载JS文件 -->
<!-- 全局变量 -->
<script src="{% static 'js/variable.js' %}"></script>

<!-- 基础组件 -->
<script src="{% static 'js/dragger.js' %}"></script>

<!-- 页面组件 -->
<script src="{% static 'js/navbar.js' %}"></script>
<script src="{% static 'js/canvas.js' %}"></script>

<!-- 页面逻辑 -->
<script src="{% static 'js/index.js' %}"></script>

<script>
    // JavaScript代码

    document.querySelectorAll('.sidebar-item').forEach(item => {
        item.addEventListener('click', function() {
            const contentId = this.getAttribute('data-content');
            const informationBlock = document.getElementById('content-block');
            // 隐藏所有内容
            for (let child of informationBlock.children) {
                child.style.display = 'none';
            }
            // 显示选中的内容项
            document.getElementById(contentId).style.display = 'block';
        });
    });

    function refreshNodeSelector() {
        var selector = document.getElementById('networkNodeSelector');
        // 清空现有的选项
        selector.innerHTML = '';

        // 添加一个空元素作为默认选项
        var option = document.createElement('option');
        selector.appendChild(option);

        // 遍历nodes数组，为每个节点创建一个<option>元素
        canvas_obj.nodes.forEach(function(node) {
            var option = document.createElement('option');
            option.value = node.nodeId; // 可以将id作为value，或者根据需要设置其他值
            // option.value = node.obj;
            option.textContent = `${node.fullName}[ID:${node.nodeId}]`; // 设置显示的文本
            selector.appendChild(option); // 将<option>添加到<select>中
        });
    }

    // 监听按钮点击事件
    document.getElementById('content-item1-fresh').addEventListener('click', function() {
        refreshNodeSelector(); // 调用refreshNodeSelector方法来更新select元素
    });

    // 监听下拉列表的变化
    document.getElementById('networkNodeSelector').addEventListener('change', function(event) {
        const features_box = document.querySelector('.element-information-features');
        const params_box = document.querySelector('.element-information-params');
        const inputs_box = document.querySelector('.element-information-inputs');
        const outputs_box = document.querySelector('.element-information-outputs');

        // const selectedNode = event.target.value;
        const selectedNode = canvas_obj.nodes.find(node => node.nodeId == event.target.value); // 根据id查找节点对象

        // 清空showbox的内容
        features_box.innerHTML = '';
        params_box.innerHTML = '<table><tbody></tbody></table>';
        inputs_box.innerHTML = '<table><tbody></tbody></table>';
        outputs_box.innerHTML = '<table><tbody></tbody></table>';

        // 判断是否为空
        if (!selectedNode) {
            ; // 什么都不做
        } else {
            // features_box
            const name_div = document.createElement('div');
            name_div.textContent = `名称: ${selectedNode.name}`;
            features_box.appendChild(name_div);

            const fullname_div = document.createElement('div');
            fullname_div.textContent = `全名: ${selectedNode.fullName}`;
            features_box.appendChild(fullname_div);

            const nodeid_div = document.createElement('div');
            nodeid_div.textContent = `节点ID: ${selectedNode.nodeId}`;
            features_box.appendChild(nodeid_div);

            const type_div = document.createElement('div');
            type_div.textContent = `节点类型: ${selectedNode.is_class == 1 ? '类' : selectedNode.is_class == 0 ? '函数' : '未知'}`;
            features_box.appendChild(type_div);

            // params_box
            const paramsFields = ['名称', '必要', '取值', '操作'];

            // 表头
            const paramsTable = params_box.querySelector('table');
            const paramsTableHead = document.createElement('thead');
            const paramsTableRowHead = document.createElement('tr');
            paramsFields.forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                paramsTableRowHead.appendChild(th);
            });
            paramsTableHead.appendChild(paramsTableRowHead);
            paramsTable.appendChild(paramsTableHead);

            const paramsTableBody = params_box.querySelector('tbody');
            for (let item of selectedNode.parameters) {
                const row = document.createElement('tr');
                for (let idx=0; idx<paramsFields.length; idx++) {
                    const cell = document.createElement('td');
                    if (idx < 3) {
                        if (paramsFields[idx] != '必要') { // 必要参数不能修改
                            const input = document.createElement('input');
                            input.value = item[idx];
                            input.style.border = 'none'; // 移除边框
                            input.style.width = '90%'; // 略微小一点，避免超出
                            cell.appendChild(input);
                        } else {
                            cell.textContent = item[idx];
                        }
                    } else {
                        // 增加 +, - 按钮
                        const button_add = document.createElement('button');
                        const button_sub = document.createElement('button');
                        button_add.textContent = '+';
                        button_sub.textContent = '-';
                        cell.appendChild(button_add);
                        cell.appendChild(button_sub);
                    }
                    row.appendChild(cell);
                }
                paramsTableBody.appendChild(row);
            }

            // inputs_box
            const inputsFields = ['名称', '必要', '取值', '操作'];

            // 表头
            const inputsTable = inputs_box.querySelector('table');
            const inputsTableHead = document.createElement('thead');
            const inputsTableRowHead = document.createElement('tr');
            inputsFields.forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                inputsTableRowHead.appendChild(th);
            });
            inputsTableHead.appendChild(inputsTableRowHead);
            inputsTable.appendChild(inputsTableHead);

            const inputsTableBody = inputs_box.querySelector('tbody');
            for (let item of selectedNode.inputs) {
                const row = document.createElement('tr');
                for (let idx=0; idx<inputsFields.length; idx++) {
                    const cell = document.createElement('td');
                    if (idx < 3) {
                        if (inputsFields[idx] != '必要') { // 必要参数不能修改
                            const input = document.createElement('input');
                            input.value = item[idx];
                            input.style.border = 'none'; // 移除边框
                            input.style.width = '90%'; // 略微小一点，避免超出
                            cell.appendChild(input);
                        } else {
                            cell.textContent = item[idx];
                        }
                    } else {
                        // 增加 +, - 按钮
                        const button_add = document.createElement('button');
                        const button_sub = document.createElement('button');
                        button_add.textContent = '+';
                        button_sub.textContent = '-';
                        cell.appendChild(button_add);
                        cell.appendChild(button_sub);
                    }
                    row.appendChild(cell);
                }
                inputsTableBody.appendChild(row);
            }

            // outputs_box
            const outputsFields = ['名称', '操作'];

            // 表头
            const outputsTable = outputs_box.querySelector('table');
            const outputsTableHead = document.createElement('thead');
            const outputsTableRowHead = document.createElement('tr');
            outputsFields.forEach(text => {
                const th = document.createElement('th');
                th.textContent = text;
                outputsTableRowHead.appendChild(th);
            });
            outputsTableHead.appendChild(outputsTableRowHead);
            outputsTable.appendChild(outputsTableHead);

            const outputsTableBody = outputs_box.querySelector('tbody');
            for (let item of selectedNode.outputs) {
                const row = document.createElement('tr');
                for (let idx=0; idx<outputsFields.length; idx++) {
                    const cell = document.createElement('td');
                    if (idx < 1) {
                        const input = document.createElement('input');
                        input.value = item[idx];
                        input.style.border = 'none'; // 移除边框
                        input.style.width = '90%'; // 略微小一点，避免超出
                        cell.appendChild(input);
                    } else {
                        // 增加 +, - 按钮
                        const button_add = document.createElement('button');
                        const button_sub = document.createElement('button');
                        button_add.textContent = '+';
                        button_sub.textContent = '-';
                        cell.appendChild(button_add);
                        cell.appendChild(button_sub);
                    }
                    row.appendChild(cell);
                }
                outputsTableBody.appendChild(row);
            }
        }
    });

</script>



</body> <!-- 网页的主体部分结束 -->
</html> <!-- HTML文档结束 -->


